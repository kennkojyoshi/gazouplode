<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>画像アップロード（Firestore-Base64）& 制作者コメント</title>
  <style>
    :root { --border:#e5e7eb; --muted:#6b7280; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:980px;margin:24px auto;padding:0 12px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .card{border:1px solid var(--border);border-radius:16px;padding:16px;margin:16px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .btn{cursor:pointer;border:1px solid #111;border-radius:999px;padding:8px 14px;background:#111;color:#fff}
    .btn.secondary{background:#fff;color:#111}
    .muted{color:var(--muted);font-size:12px}
    img.preview{max-width:100%;height:auto;border-radius:12px}
    .photo{display:grid;grid-template-columns:180px 1fr;gap:16px;align-items:start}
    .comment{background:#f9fafb;border:1px solid var(--border);border-radius:12px;padding:12px;margin:8px 0}
    textarea{width:100%;min-height:80px}
    input[type="email"], input[type="password"]{width:100%;padding:8px;border:1px solid var(--border);border-radius:10px}
    @media (max-width:800px){.row,.photo{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <h1>画像アップロード（Firestore-Base64）& 制作者コメント</h1>
  </header>

  <!-- 0) ログインUI -->
  <section class="card" id="authCard">
    <h2>ログイン</h2>
    <div class="row">
      <div>
        <label class="muted">管理者メール</label>
        <input id="email" type="email" placeholder="admin@example.com" />
        <label class="muted" style="margin-top:8px;display:block">パスワード</label>
        <input id="password" type="password" placeholder="••••••••" />
      </div>
      <div>
        <button id="adminLoginBtn" class="btn" style="width:100%;margin-bottom:8px">管理者ログイン（メール/パス）</button>
        <button id="anonLoginBtn" class="btn secondary" style="width:100%;margin-bottom:8px">匿名ログイン（一般）</button>
        <button id="logoutBtn" class="btn secondary" style="width:100%;display:none">ログアウト</button>
        <div id="authInfo" class="muted" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>1) 画像をアップロード</h2>
    <p class="muted">無料（Spark）で動く版。画像は <b>Base64（圧縮済みJPEG）</b> を Firestore に保存します。推奨: 最大幅1280px / 品質0.8 / 約200〜400KB/枚。</p>
    <div class="row">
      <div>
        <input type="file" id="fileInput" accept="image/*" />
        <div id="previewWrap" style="margin-top:12px"></div>
      </div>
      <div>
        <button id="uploadBtn" class="btn" disabled>アップロード</button>
        <div class="muted" id="uploadInfo" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <section class="card" id="galleryCard">
    <h2>2) ギャラリー & コメント</h2>
    <div id="gallery"></div>
  </section>

<!-- Firebase v10 CDN (modular) -->
<script type="module">
  // === 1) Firebase設定（あなたのプロジェクト）===
  const firebaseConfig = {
    apiKey: "AIzaSyAt4ebgY4u1ySZt1BZjqXTXOMG49h6A-T0",
    authDomain: "gazo-upload-e4201.firebaseapp.com",
    projectId: "gazo-upload-e4201",
    storageBucket: "gazo-upload-e4201.appspot.com",
    messagingSenderId: "1077188830783",
    appId: "1:1077188830783:web:4d4356de2b301eec957a8a",
    measurementId: "G-3R3LT0LXE7"
  };

  // 制作者UID（管理者）
  const ADMIN_UID = "sV77t4Rsi4gzeAAnYzbfosPAt942";

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInAnonymously, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- ここから下はあなたの既存の処理を入れる ---
</script>


  <!-- 使い方メモ（このHTMLはそのままGitHubに置けます）
  1) Authentication: 匿名＋メール/パスを有効化。管理者アカ作成済み（UIDはADMIN_UIDに設定）。
  2) Firestore: 本番モードで作成。下のルールを貼って公開（ADMIN_UIDは同じ値）。
  3) GitHubにアップロード → Pages公開。匿名でアップ、管理者で閲覧＆コメント。
  -->
</body>
</html>
